#AndroidNDK开发环境搭建

[TOC "float:left"]


  ##一、NDK的简介
1、Android的架构建立在Linux系统之上的
 * Linux Kernel 硬件驱动的
 * Libraries
 * Appaction framwork
 * Application
 以上前两种是用C或C++开发的，下面是用java语言开发的

2、Native Development Kit（NDK缩写）本地开发工具
3、Java Native Interface  (JNI缩写) Java本地调用。最主要的作用是允许java的代码与其他语言的代码进行交互
4、为什么需要NDK
* java虚拟机不支持硬件设备。如TV，车载IVI
* C或C++等其他语言已经开发好了，只需要JNI提供API来调用即可

5、Android提供的一些源码网址分享
* androidxref.com
* source.android.com
* 游戏引擎www.cocos2d.x.org可以运行在android系统上面

##二、Windows开发环境的搭建
1、需要一个Cygwin1.7以上的环境来模拟Linux环境；地址：www.cygwin.com/
2、Android官网里面下载AndroidSDK以及编译工具
3、NDK插件

* Cygwin安装成功以后，make命令一定要安装成功。否则环境搭建是失败的，可以再次点击setup  检测make时使用which make

##三、Demo开发
1、建立项目，在包名下面创建JniText.java文件

```
public class JniText {
    static {
        System.loadLibrary("Jnitext");
    }
    public static native String getCLangString();
}
```
2、make一下project项目，输入app/build/intermediates/classes/debug后

```
javah -jni com.yip.yipjnidemo.JniText
```
输入完成以后会自动在该目录下生成一个文件com_yip_yipjnidemo_JniText.h
```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_yip_yipjnidemo_JniText */

#ifndef _Included_com_yip_yipjnidemo_JniText
#define _Included_com_yip_yipjnidemo_JniText
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_yip_yipjnidemo_JniText
 * Method:    getCLangString
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_com_yip_yipjnidemo_JniText_getCLangString
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```
3、创建一个jni文件夹，注意从Floder里面创建。然后将.h文件放进这个文件夹里面。然后创建一个com_yip_yipjnidemo_JniText.c文件

```
#include "com_yip_yipjnidemo_JniText.h"
  /*
   * Class:     io_github_yanbober_ndkapplication_NdkJniUtils
   * Method:    getCLanguageString
   * Signature: ()Ljava/lang/String;
   */
JNIEXPORT jstring JNICALL Java_com_yip_yipjnidemo_JniText_getCLangString(JNIEnv *env, jobject obj)
{
return (*env)->NewStringUTF(env,"This just a test for Android Studio NDK JNI developer!");
}
```
4、创建一个Android.mk文件
```
LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)
LOCAL_MODULE := Jnitext
LOCAL_SRC_FILES := com_yip_yipjnidemo_JniText.c
APP_ABI := armeabi armeabi-v7a x86
include $(BUILD_SHARED_LIBRARY)
```
4、然后编写MainActivity
```
public class MainActivity extends AppCompatActivity {

    private TextView txtView;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        txtView= (TextView) findViewById(R.id.text);

        JniText jniText=new JniText();
        txtView.setText(jniText.getCLangString());
    }
}

```
5、在app下的build.gradle目录下添加
```
 sourceSets.main {
            jniLibs.srcDir 'src/main/libs'
            jni.srcDirs = [] //disable automatic ndk-build call
        }
```
6、进入目录后，通过ndk-build命令编译成.so库，可以通过
```
ndk-build APP_ABI="armeabi armeabi-v7a x86 mips"
```
生成不同平台的.so文件

最后就就可以愉快的创建成功了

